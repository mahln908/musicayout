<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>House MP3 - Player Vertical</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #121212;
            color: white;
            line-height: 1.4;
        }
        
        header {
            background-color: #000;
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-title {
            font-size: 18px;
        }
        
        .mobile-back-button {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        .container {
            max-width: 100%;
            padding: 15px;
            margin-bottom: 80px;
        }
        
        .search-box {
            display: flex;
            margin-bottom: 20px;
        }
        
        .search-box input {
            flex: 1;
            padding: 12px 15px;
            font-size: 14px;
            border: none;
            border-radius: 20px 0 0 20px;
            background-color: #2d2d2d;
            color: white;
        }
        
        .search-box button {
            padding: 0 20px;
            background-color: #1DB954;
            color: white;
            border: none;
            border-radius: 0 20px 20px 0;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        
        /* Lista vertical de resultados */
        .results-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .result-item {
            display: flex;
            align-items: center;
            background-color: #181818;
            border-radius: 6px;
            padding: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .result-item:hover {
            background-color: #282828;
        }
        
        .result-thumbnail {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            margin-right: 15px;
            flex-shrink: 0;
            background-size: cover;
            background-position: center;
        }
        
        .result-info {
            flex: 1;
            min-width: 0;
        }
        
        .result-info h3 {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 5px;
        }
        
        .result-info p {
            font-size: 12px;
            color: #b3b3b3;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Página do player */
        .player-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #000;
            z-index: 1000;
            padding-top: 60px;
            overflow-y: auto;
            padding-bottom: 150px;
        }
        
        .player-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #000;
            padding: 15px;
            z-index: 1001;
            display: flex;
            align-items: center;
        }
        
        .back-button {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            margin-right: 15px;
        }
        
        .player-title {
            font-size: 16px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .youtube-container {
            width: 100%;
            margin: 0 auto;
            aspect-ratio: 16/9;
            margin-bottom: 30px;
        }
        
        .up-next {
            padding: 0 15px;
        }
        
        .up-next h2 {
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        /* Player estilo Spotify */
        .spotify-player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background-color: #181818;
            border-top: 1px solid #282828;
            display: flex;
            align-items: center;
            padding: 0 15px;
            z-index: 100;
            gap: 15px;
        }
        
        .player-info {
            display: flex;
            align-items: center;
            min-width: 0;
            flex: 1;
        }
        
        .player-thumbnail {
            width: 50px;
            height: 50px;
            border-radius: 4px;
            background-size: cover;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .player-text {
            overflow: hidden;
            min-width: 0;
        }
        
        .player-text h4 {
            margin: 0;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .player-text p {
            margin: 0;
            color: #b3b3b3;
            font-size: 11px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .player-controls {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 300px;
        }
        
        .control-buttons {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .control-buttons button {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            margin: 0 10px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #play-button {
            background-color: #1DB954;
            border-radius: 50%;
            font-size: 14px;
        }
        
        .progress-container {
            width: 100%;
        }
        
        .progress-bar {
            width: 100%;
            height: 3px;
            background-color: #535353;
            border-radius: 2px;
            cursor: pointer;
        }
        
        .progress {
            height: 100%;
            background-color: #1DB954;
            border-radius: 2px;
            width: 0%;
        }
        
        .time {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #b3b3b3;
            margin-top: 3px;
        }
        
        .favorite-btn {
            color: #b3b3b3;
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
            flex-shrink: 0;
        }
        
        .favorite-btn.active {
            color: #1DB954;
        }
        
        @media (max-width: 768px) {
            .mobile-back-button {
                display: block;
            }
            
            .header-title {
                font-size: 16px;
            }
            
            .result-item {
                padding: 8px;
            }
            
            .result-thumbnail {
                width: 50px;
                height: 50px;
                margin-right: 10px;
            }
            
            .spotify-player {
                height: 70px;
            }
            
            .player-thumbnail {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <header id="main-header">
        <button class="mobile-back-button" id="mobile-back-button">←</button>
        <div class="header-title">House MP3</div>
        <div style="width: 24px;"></div> <!-- Espaço para alinhamento -->
    </header>
    
    <div class="container" id="main-container">
        <div class="search-box">
            <input type="text" id="search-input" placeholder="Buscar músicas...">
            <button id="search-button">Buscar</button>
        </div>
        
        <div class="results-list" id="results">
            <!-- Resultados aparecerão aqui -->
        </div>
    </div>
    
    <div class="player-page" id="player-page">
        <div class="player-header">
            <button class="back-button" id="back-button">←</button>
            <div class="player-title" id="player-title"></div>
        </div>
        
        <div class="youtube-container">
            <div id="youtube-player"></div>
        </div>
        
        <div class="up-next">
            <h2>Próximas músicas</h2>
            <div class="results-list" id="up-next-list">
                <!-- Próximas músicas aparecerão aqui -->
            </div>
        </div>
    </div>
    
    <div class="spotify-player" id="spotify-player">
        <div class="player-info">
            <div class="player-thumbnail" id="player-thumbnail"></div>
            <div class="player-text">
                <h4 id="now-playing-title">Nenhuma música</h4>
                <p id="now-playing-artist"></p>
            </div>
            <div class="favorite-btn" id="favorite-btn">♥</div>
        </div>
        
        <div class="player-controls">
            <div class="control-buttons">
                <button id="prev-button">⏮</button>
                <button id="play-button">▶</button>
                <button id="next-button">⏭</button>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="time">
                    <span id="current-time">0:00</span>
                    <span id="duration">0:00</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configurações
        const API_KEY = 'AIzaSyC_8CHxOvjcNCs36B-Omt3v5VjzVAazdIw';
        let player;
        let currentVideoId = '';
        let currentVideoTitle = '';
        let currentVideoArtist = '';
        let currentVideoThumbnail = '';
        let searchResults = [];
        let currentIndex = 0;
        let isPlaying = false;
        let progressInterval;
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

        // Elementos do DOM
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const resultsContainer = document.getElementById('results');
        const mainContainer = document.getElementById('main-container');
        const playerPage = document.getElementById('player-page');
        const backButton = document.getElementById('back-button');
        const mobileBackButton = document.getElementById('mobile-back-button');
        const spotifyPlayer = document.getElementById('spotify-player');
        const playButton = document.getElementById('play-button');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const progressBar = document.getElementById('progress-bar');
        const progress = document.getElementById('progress');
        const currentTimeElement = document.getElementById('current-time');
        const durationElement = document.getElementById('duration');
        const nowPlayingTitle = document.getElementById('now-playing-title');
        const nowPlayingArtist = document.getElementById('now-playing-artist');
        const playerThumbnail = document.getElementById('player-thumbnail');
        const favoriteBtn = document.getElementById('favorite-btn');
        const upNextList = document.getElementById('up-next-list');
        const playerTitle = document.getElementById('player-title');
        const mainHeader = document.getElementById('main-header');

        // Carrega a API do YouTube
        function loadYouTubeAPI() {
            if (window.YT) {
                createPlayer();
                return;
            }
            
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }

        // Cria o player do YouTube
        function createPlayer() {
            player = new YT.Player('youtube-player', {
                height: '100%',
                width: '100%',
                playerVars: {
                    'autoplay': 1,
                    'controls': 1,
                    'disablekb': 1,
                    'modestbranding': 1,
                    'rel': 0
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // Quando a API estiver pronta
        window.onYouTubeIframeAPIReady = createPlayer;

        function onPlayerReady(event) {
            console.log('Player pronto');
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                isPlaying = true;
                updatePlayButton();
                updateProgressBar();
            } else if (event.data == YT.PlayerState.PAUSED) {
                isPlaying = false;
                updatePlayButton();
                clearInterval(progressInterval);
            } else if (event.data == YT.PlayerState.ENDED) {
                playNext();
            }
        }

        // Busca vídeos no YouTube
        async function searchVideos() {
            const query = searchInput.value.trim();
            if (!query) return;
            
            try {
                const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=15&q=${encodeURIComponent(query)}&type=video&key=${API_KEY}`);
                
                if (!response.ok) {
                    throw new Error('Erro na requisição');
                }
                
                const data = await response.json();
                searchResults = data.items;
                displayResults(data.items);
            } catch (error) {
                console.error('Erro na busca:', error);
                resultsContainer.innerHTML = '<div class="result-item" style="justify-content:center;color:red">Erro ao buscar vídeos. Tente novamente.</div>';
            }
        }

        // Exibe os resultados em lista vertical
        function displayResults(videos) {
            resultsContainer.innerHTML = '';
            
            if (videos.length === 0) {
                resultsContainer.innerHTML = '<div class="result-item" style="justify-content:center">Nenhum resultado encontrado</div>';
                return;
            }
            
            videos.forEach((video, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.onclick = () => playVideo(index);
                
                const thumbnailUrl = video.snippet.thumbnails?.medium?.url || '';
                
                resultItem.innerHTML = `
                    <div class="result-thumbnail" style="background-image:url('${thumbnailUrl}')"></div>
                    <div class="result-info">
                        <h3>${video.snippet.title}</h3>
                        <p>${video.snippet.channelTitle}</p>
                    </div>
                `;
                
                resultsContainer.appendChild(resultItem);
            });
        }

        // Toca um vídeo
        function playVideo(index) {
            const video = searchResults[index];
            if (!video) return;
            
            currentVideoId = video.id.videoId;
            currentVideoTitle = video.snippet.title;
            currentVideoArtist = video.snippet.channelTitle;
            currentVideoThumbnail = video.snippet.thumbnails?.medium?.url || '';
            currentIndex = index;
            
            // Mostra a página do player e esconde a principal
            mainContainer.style.display = 'none';
            playerPage.style.display = 'block';
            spotifyPlayer.style.display = 'flex';
            mainHeader.style.display = 'none';
            
            // Atualiza a UI
            updatePlayerUI();
            updateUpNextList();
            
            // Carrega e toca o vídeo
            if (player) {
                player.loadVideoById(currentVideoId);
                player.playVideo();
            }
        }

        // Atualiza a lista de próximas músicas
        function updateUpNextList() {
            upNextList.innerHTML = '';
            playerTitle.textContent = currentVideoTitle;
            
            // Mostra as próximas 5 músicas da lista
            for (let i = 1; i <= 5; i++) {
                const nextIndex = (currentIndex + i) % searchResults.length;
                const video = searchResults[nextIndex];
                if (!video) continue;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.onclick = () => playVideo(nextIndex);
                
                const thumbnailUrl = video.snippet.thumbnails?.medium?.url || '';
                
                resultItem.innerHTML = `
                    <div class="result-thumbnail" style="background-image:url('${thumbnailUrl}')"></div>
                    <div class="result-info">
                        <h3>${video.snippet.title}</h3>
                        <p>${video.snippet.channelTitle}</p>
                    </div>
                `;
                
                upNextList.appendChild(resultItem);
            }
        }

        // Volta para a página principal
        function goBack() {
            mainContainer.style.display = 'block';
            playerPage.style.display = 'none';
            mainHeader.style.display = 'flex';
        }

        // Atualiza a UI do player
        function updatePlayerUI() {
            nowPlayingTitle.textContent = currentVideoTitle;
            nowPlayingArtist.textContent = currentVideoArtist;
            
            if (currentVideoThumbnail) {
                playerThumbnail.style.backgroundImage = `url(${currentVideoThumbnail})`;
            }
            
            updateFavoriteButton();
        }

        // Toca o próximo vídeo
        function playNext() {
            if (searchResults.length === 0) return;
            currentIndex = (currentIndex + 1) % searchResults.length;
            playVideo(currentIndex);
        }

        // Toca o vídeo anterior
        function playPrev() {
            if (searchResults.length === 0) return;
            currentIndex = (currentIndex - 1 + searchResults.length) % searchResults.length;
            playVideo(currentIndex);
        }

        // Atualiza o botão de play/pause
        function updatePlayButton() {
            playButton.textContent = isPlaying ? '⏸' : '▶';
        }

          // Atualiza a barra de progresso
        function updateProgressBar() {
            clearInterval(progressInterval);
            
            progressInterval = setInterval(() => {
                if (!player) return;
                
                const currentTime = player.getCurrentTime();
                const duration = player.getDuration();
                
                if (duration > 0) {
                    const percent = (currentTime / duration) * 100;
                    progress.style.width = `${percent}%`;
                    
                    currentTimeElement.textContent = formatTime(currentTime);
                    durationElement.textContent = formatTime(duration);
                }
            }, 1000);
        }

        // Formata o tempo (segundos) para MM:SS
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // Adiciona/remove dos favoritos
        function toggleFavorite() {
            const index = favorites.findIndex(fav => fav.id === currentVideoId);
            
            if (index === -1) {
                favorites.push({
                    id: currentVideoId,
                    title: currentVideoTitle,
                    artist: currentVideoArtist,
                    thumbnail: currentVideoThumbnail
                });
            } else {
                favorites.splice(index, 1);
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoriteButton();
        }

        // Atualiza o botão de favoritos
        function updateFavoriteButton() {
            const isFavorite = favorites.some(fav => fav.id === currentVideoId);
            favoriteBtn.classList.toggle('active', isFavorite);
        }

        // Configura os event listeners
        function setupEventListeners() {
            searchButton.addEventListener('click', searchVideos);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchVideos();
            });
            
            playButton.addEventListener('click', () => {
                if (!player) return;
                
                if (isPlaying) {
                    player.pauseVideo();
                } else {
                    player.playVideo();
                }
            });
            
            prevButton.addEventListener('click', playPrev);
            nextButton.addEventListener('click', playNext);
            
            progressBar.addEventListener('click', (e) => {
                if (!player) return;
                
                const rect = progressBar.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                player.seekTo(player.getDuration() * pos);
            });
            
            favoriteBtn.addEventListener('click', toggleFavorite);
            backButton.addEventListener('click', goBack);
            mobileBackButton.addEventListener('click', goBack);
        }

        // Inicializa o player
        loadYouTubeAPI();
        
        // Configura os eventos quando a página carregar
        window.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            spotifyPlayer.style.display = 'none';
        });
    </script>
</body>
</html>
